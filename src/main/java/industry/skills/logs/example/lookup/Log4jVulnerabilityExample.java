package industry.skills.logs.example.lookup;

import org.apache.logging.log4j.LogManager;
import org.apache.logging.log4j.Logger;

import javax.naming.Context;
import javax.naming.NamingEnumeration;
import javax.naming.NamingException;
import javax.naming.directory.DirContext;
import javax.naming.directory.InitialDirContext;
import javax.naming.directory.SearchControls;
import javax.naming.directory.SearchResult;
import java.util.Properties;
//video: 100195 - Log4j2 [JAD, JavaFX] | Powered by SpeaCode
public class Log4jVulnerabilityExample {

    private static Logger logger = LogManager.getLogger(Log4jVulnerabilityExample.class);

    private static void jndiFetch() throws NamingException {
        Properties props = new Properties();
        props.put(Context.INITIAL_CONTEXT_FACTORY,"com.sun.jndi.ldap.LdapCtxFactory");
        props.put(Context.PROVIDER_URL, "ldap://localhost:10389");
        props.put(Context.SECURITY_PRINCIPAL, "uid=admin,ou=system");
        props.put(Context.SECURITY_CREDENTIALS, "secret");
        DirContext ctx = new InitialDirContext(props);

        Object lookup = ctx.lookup("cn=menash,ou=users,ou=system");
        System.out.println(lookup);
    }

    public static void main(String[] args) throws NamingException {

        // basic
        //logger.info("Hello !");

        // introduce lookups feature:
        //logger.info("Hello ! You are running on ${java:version}");
        //logger.info("Environment variable lookup: JAVA_HOME is set to ${env:JAVA_HOME}");

        // store in JNDI some data and retrieve it via the log
        //logger.info("Environment variable lookup: JAVA_HOME is set to ${jndi:ldap://localhost:10389/dc=example,dc=com}");
        //logger.info("this is an innocent log statement that... invokes JNDI lookup for a stored object ! ${jndi:ldap://localhost:10389/cn=f,dc=example,dc=com}");
        //logger.info("this starts to be disturbing... ${jndi:ldap://localhost:10389/cn=goo,dc=example,dc=com}");
        //logger.info("WTF !!! ${jndi:ldap://localhost:10389/cn=moo,dc=example,dc=com}");
    }
}
